---
title: "tidyeval"
output: formation::exo_rmd
params:
  hide:
    value: TRUE
  warning:
    value: FALSE
  message:
    value: FALSE
  results:
    value: 'hide'
  path: 
    value: "image/"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(message = params$message, warning = params$warning, results = params$results, eval = FALSE)
library(knitr)
if (params$hide) {
  formation::hide_code()
}
```

## Load the tidyverse

```{r}
library(tidyverse)
```


## Create these 5 functions 

Create `select_and_slice`, a function that combines select() and slice(1:6). 
This should output: 

```
select_and_slice(starwars, name, gender)
# A tibble: 6 x 2
  name           gender
  <chr>          <chr> 
1 Luke Skywalker male  
2 C-3PO          NA    
3 R2-D2          NA    
4 Darth Vader    male  
5 Leia Organa    female
6 Owen Lars      male  

```

```{r}
select_and_slice <- function(df, ...) {
  df %>% 
    select(!!!quos(...)) %>%
    slice(1:6)
}
```


Create filter_na(), a function that filters out NA, given a data.frame and a column name

This should output:

```
filter_na(airquality, Ozone) %>%
  head()
    Ozone Solar.R Wind Temp Month Day
1    41     190  7.4   67     5   1
2    36     118  8.0   72     5   2
3    12     149 12.6   74     5   3
4    18     313 11.5   62     5   4
5    28      NA 14.9   66     5   6
6    23     299  8.6   65     5   7

filter_na(airquality, Solar.R) %>%
  head()
    Ozone Solar.R Wind Temp Month Day
1    41     190  7.4   67     5   1
2    36     118  8.0   72     5   2
3    12     149 12.6   74     5   3
4    18     313 11.5   62     5   4
5    23     299  8.6   65     5   7
6    19      99 13.8   59     5   8
```



```{r}
filter_na <- function(df, col) {
  col <- enquo(col)
  df %>% 
    filter(! is.na(!!col)) 
}
```

Create prop_table(), a function that takes a data.frame, a suite of columns, and counts the number of observation for each combination.

This should output:

```
prop_table(starwars, eye_color, skin_color)
# A tibble: 53 x 3
   eye_color skin_color           n
   <chr>     <chr>            <int>
 1 black     green                2
 2 black     grey                 4
 3 black     none                 1
 4 black     orange               1
 5 black     red, blue, white     1
 6 black     white, blue          1
 7 blue      blue                 1
 8 blue      brown                1
 9 blue      dark                 1
10 blue      fair                10
# ... with 43 more rows
```

```{r}
prop_table <- function(tbl, ...){
  tbl %>%
    count( !!!quos(...) ) 
}
```

Enhance prop_table() with the proporition, instead of just the count.

```
prop_table_with_prop(starwars, eye_color, skin_color)
# A tibble: 53 x 4
   eye_color skin_color           n   prop
   <chr>     <chr>            <int>  <dbl>
 1 black     green                2 0.0230
 2 black     grey                 4 0.0460
 3 black     none                 1 0.0115
 4 black     orange               1 0.0115
 5 black     red, blue, white     1 0.0115
 6 black     white, blue          1 0.0115
 7 blue      blue                 1 0.0115
 8 blue      brown                1 0.0115
 9 blue      dark                 1 0.0115
10 blue      fair                10 0.115 
# ... with 43 more rows
```


```{r}
prop_table_with_prop <- function(tbl, ...){
  col <- quos(...)
  tbl %>% 
    count(!!!col) %>% 
    mutate(prop := n / sum(n))
}
```


Create a function that takes a dataframe, a column name, and draws an histogram of the selected column. You should have the possibility to enter the number of bins.

```
gg_histo(starwars, height, 50)
```

```{r}
gg_histo <- function(df, col, bins = 50){
  col <- enquo(col)
  ggplot(df, aes(!!col)) + 
    geom_histogram(bins = bins)
}
```

## Bonus 

Code a function that behaves has gg_histo, but you can pass a series of columns, and it draws a series of histograms.

```
gg_histos(starwars, height, mass, bins = 50)
```

```{r}
gg_histos <- function(df, ..., bins){
  quosures <- quos(...)
  map(.x = quosures, function(x){
    ggplot(df, aes(!!x)) + 
      geom_histogram(bins = bins)
  })
}
```

