---
title: "Homework 1"
author: "Julie Josse"
date: "24/10/2018"
output: html_document
---
 

# PCA by hand 

The goal of this exercise is to implement Principal Component Analysis (PCA) by yourself.

```{r libraries, warning=FALSE}
library(FactoMineR)
```


Import the data Expert_wine.csv. The aim is to do a PCA on this data set, without using the function PCA of FactoMineR, i.e. using your own implementation of PCA. Remember not to include qualitative variables. First, run the function PCA of FactoMineR. 
Note that by default of the PCA function, the data is centered and standardized by columns. Besides, for each column $k$, the empirical variance used to standardize the column is 

$$ \hat{\sigma}_k = \sqrt{ \frac{1}{I}\sum_{i=1}^I (x_{ik}-\bar{x}_k)^2 } \: , \qquad  
\bar{x}_k = \frac{1}{I} \sum_{i=1}^I x_{ik}
$$

where $I$ is the number of rows of the data (here $I=10$). Be careful, in R the **scale** function computes the empirical variance as follows:

$$ \hat{\sigma}_k = \sqrt{ \frac{1}{I-1}\sum_{i=1}^I (x_{ik}-\bar{x}_k)^2 } \: , \qquad  
\bar{x}_k = \frac{1}{I} \sum_{i=1}^I x_{ik}
$$

__(R1)__ In a few lines of code, recover by yourself the eigenvalues found with PCA of FactoMineR.
```{r R1, eval = FALSE}
resPCA$eig
```

__(R2)__ In a few lines of code, recover the projections of the individuals (the coordinates of the individuals) on the 2 first principal axes.

```{r R2, eval = FALSE}
resPCA$ind$coord[,1:2]
```

__(Q3)__ From the previous question, you obtain 2 vectors of dimension $10$. Show (theoretically) that their empirical variances are respectively the first and the second eigenvalues of the PCA (given by PCA of FactoMineR for example).

__(Q4)__ Give two synthetics variables that "best summarize" the individuals. Explain what is your suggestion and gives the object (the output in the PCA function) where you can retrieve the  result.

# Questionnaire on PCA - Female fertility in Europe

Answer the Questionnaire on the Moodle. 

We are interested in female fertility in Europe in 2012. To study this, we have constructed a data table with 39 European countries as rows, and age groups as columns: 15-19, 20-24, 25-29, 30-34, 35-39, 40 and over. In the relevant table entry, we have the mean fertility of women for a given country and age group. Here, fertility means the mean number of children born per 1000 women.
To be able to answer the questions, you must run a PCA using the data set "AnaDo_JeuDonnees_FertiliteEurope.csv" stored on the Moodle. 
Your aim is to be able to explain and describe female fertility in Europe. After thinking about which variables should be active, and which variables should be supplementary, perform a PCA on this data set and then answer the questionnaire.

# Quizz

Answer with 2 or 3 sentences maximum.

__Q1__ How are calculated the coordinates of the quantitatives supplementary variables in PCA?

__Q2__ In the correlation circle graph in PCA, explain how you can interpret the size of an arrow associated
to a specific variable?


## Approximation of the ozone data

Air pollution is currently one of the most serious public health worries worldwide.
Many epidemiological studies have proved the influence that some chemical
compounds, such as sulphur dioxide (SO2), nitrogen dioxide (NO2), ozone
(O3) can have on our health.
Associations set up to monitor air quality are active all over the world to
measure the concentration of these pollutants. They also keep a record of
meteorological conditions such as temperature, cloud cover, wind, etc.
Here the final aim is to analyse the relationship between the maximum daily ozone
level  and meteorological variables. We have at our disposal 112 observations
collected during the summer of 2001 in Rennes. Before trying to build a prediction model, we will inspect the data with a PCA and illustrate the reconstruction property of PCA.
The variables available are
maxO3 (maximum daily ozone), maxO3v (maximum daily ozone the previous day), T12 (temperature at midday), T9, T15 (Temp at 3pm), wind (direction),
rain and Vx12 (projection of the wind speed vector on the east-west
axis at midday), Vx9 and Vx15, as well as the Nebulosity (cloud) Ne9, Ne12, Ne15. The data is contained in the file ozone.txt.

1. Perform the PCA on the ozone data  (also using the categorical variables) and give an  interpretation of the first dimensions of variability (interpretation of the observations plot, correlation between variables, percentage of variability, etc.). The variable maxO3 that we want to predict using a regression model for instance can be put as a supplementary variable in the analysis. This is often done in order to inspect the correlation betwenn the $X$ and to see how the $Y$ variable that we want to explain is related to the main dimensions of variability in $X$.

2. With the PCA outputs, one could reconstruct the data with the reconstruction formulae.  First, reconstruct the data with one dimension. You should be aware that with the results of PCA, you could reconstruct the centered and scaled data, so that you may need to add the means and multiply by the standard deviations to get the approximation of the original matrix.
We remind that we can get a $1$-dimensionnal approximation of the true data by the following procedure: $\hat{X^1}=Fu'= Xuu'$ 
 $F$ is the matrice of size $I \times 1$  containing the first principal components, also known as the scores or the coordinates of the $I$ observations on the principal component. $u$ are the principal axes. Be careful, in FactoMineR outputs, you have the coordinates of the variables, but from them, you can retrieve the $u$.

3. Calling $\hat{X}$ the reconstructed matrix, observe the difference between $X$ and $\hat X$ by plotting the variable maxO3y for the two matrices in function of the observations. Comment.



4. Build a function to reconstruct the data with a specific number of dimensions. Then, reconstruct the data with 2 to 4 dimensions and represent different variables (observed and estimated). Comment your results with respect to the correlation circle (You can plot different variables, Wx12, etc.).

You should check that your function and the function ```reconst``` of the FactoMineR package outputs the same results.

## Reconstruction of an image

1. Import the data missing.jpg or breton.png  and reconstruct the image with 1 to 100 dimensions. There are different packages dedicated to images. 
With the following lines of code, you could  read an image, reprensent it and then transform it in a grey scale. (Be careful that you may need to execute the code in the R console and not by knitting).

```{r, echo=TRUE, include = TRUE, eval = FALSE}
source("https://bioconductor.org/biocLite.R")
biocLite("EBImage")
```

```{r, echo=TRUE, include = TRUE, eval = FALSE}
library("EBImage")
img <- readImage("data/missing.jpg")
display(img, method = "raster")

library(ripa)
r <- imagematrix(img, type = "grey")
display(r, method = "raster")
```

2. Using the grey image (r), reconstruct the image with 1 to 100 dimensions and export the reconstructed images in a folder with the names "missing_ncp_1" to "missing_ncp_100". You could use the packages "jpeg" and "png" to export the image with functions 'writePNG' for instance.  Comment.




